{%  extends 'base.html' %}

{% block sidebar %}
<form class="p-2" action="{{ url_for('exploit.rank') }}" method="post">
    <div class="form-group">
        <h6>Similarity with profile</h6>
        <label for="similarity_profile_content">Content:</label>
        <input type="number" class="form-control" id="similarity_profile_content" value="{{ rank_weights['similarity_profile_content'] }}" name="similarity_profile_content">
        <label for="similarity_profile_graph">Graph:</label>
        <input type="number" class="form-control" id="similarity_profile_graph" value="{{ rank_weights['similarity_profile_graph'] }}" name="similarity_profile_graph">
    </div>
    <div class="form-group">
        <h6>Infra-list diversity</h6>
        <label for="similarity_infra_content">Content:</label>
        <input type="number" class="form-control" id="similarity_infra_content" value="{{ rank_weights['similarity_infra_content'] }}" name="similarity_infra_content">
        <label for="similarity_infra_graph">Graph:</label>
        <input type="number" class="form-control" id="similarity_infra_graph" value="{{ rank_weights['similarity_infra_graph'] }}" name="similarity_infra_graph">
    </div>
    <div class="form-group">
        <h6>Novelty</h6>
        <label for="novelty_year">Publication year:</label>
        <input type="number" class="form-control" id="novelty_year" value="{{ rank_weights['novelty_year'] }}" name="novelty_year">
        <label for="novelty_popularity">Inverse popularity:</label>
        <input type="number" class="form-control" id="novelty_popularity" value="{{ rank_weights['novelty_popularity'] }}" name="novelty_popularity">
    </div>
    <div class="form-group">
        <input type="submit" value="Rank" class="btn btn-primary">
    </div>
</form>
{% endblock %}

{% block header %}
<h1>{% block title %}Exploit{% endblock %}
    <button class="btn btn-info btn-sm" type="button" data-toggle="collapse" data-target="#help" aria-expanded="true" aria-controls="help">
    Hide/Show
    </button>
</h1>
{% endblock %}

{% block content %}
<div class="collapse show" id="help">
  <div class="card card-body">
      <p>The main feature is the ranking function that allows the user to sort the papers according to his objectives.
      It uses six criteria which cover three search objectives : proximity with the research topic (i.e. accuracy),
      diversity of the recommended paper, and novelty of the papers to the user. The user can
      parametrizes this criteria by adjusting the corresponding weight (with positive or negative integers).</p>
      <ul>
          <li><b>Similarity with user profile</b> (i.e. the input papers):
              <i>Content-based</i> and <i>Graph-based</i> similarities are available. Their purpose is to sort papers
              according to similar content or common in/out citations with the input papers. They are based respectively
              on TF-IDF/cosine similarity and Jaccard index on in/out citations. A positive value favours similarity.
          </li>
          <li><b>Infra-list diversity</b>(i.e. between recommended papers):
              The idea is to follow a greedy approach to reorder the items in such a way that each paper is the most
              dissimilar to the previous ones. This enables the first items to be representative of the diversity of
              the complete list. <i>Content-based</i> and <i>Graph-based</i> approaches are available. They are based
              respectively on TF-IDF/complement of cosine similarity and complement of Jaccard index on in/out citations.
              A positive value favours diversity.
          </li>
          <li><b>Novelty</b>: <i>Publication year</i> and <i>Inverse popularity</i> are available.
              Novelty obviously means novelty in time, but also novelty for the user (i.e. unknown). The idea behind
              inverse popularity is that an unpopular paper is more susceptible to be new/unknown for the user. Given
              the fact that popularity of papers is not available as is, it is approximated by the number of citations.
              A positive value favours respectively publication recency or unpopularity.
          </li>
      </ul>
      <p>You can manage the results with the following buttons:</p>
      <ul>
          <li><button class="btn btn-primary btn-sm" type="submit">Input selected papers</button> adds the selected papers
          to the inputs for recommendation (<a href="{{ url_for('recommend.recommend') }}">Recommend</a> module).</li>
          <li><button class="btn btn-success btn-sm" type="submit">Save selected papers</button> adds the selected papers
          to the <a href="{{ url_for('save.show') }}">Save</a> module.</li>
          <li><button class="btn btn-danger btn-sm" type="submit">Delete selected papers</button> removes selected papers
          from the current results.</li>
      </ul>
  </div>
</div>

<h3>Results</h3>

{% if get_flashed_messages() %}
{% import 'message.html' as message_macro %}
{{ message_macro.message_render(get_flashed_messages(with_categories=true)) }}
{% endif %}

<form method="post">
    {% import 'paper_table.html' as paper_table_macro %}
    {{ paper_table_macro.table_render(papers) }}
    <button class="btn btn-primary btn-lg" type="submit" formaction="{{ url_for('exploit.add') }}">Input selected papers</button>
    <button class="btn btn-success btn-lg" type="submit" formaction="{{ url_for('exploit.save') }}">Save selected papers</button>
    <button class="btn btn-danger btn-lg" type="submit" formaction="{{ url_for('exploit.delete') }}">Delete selected papers</button>
</form>
{% endblock %}